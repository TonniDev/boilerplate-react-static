0a3fb5bf575dd79679b7095ec0b00380
'use strict';

var addSorting = function () {
    "use strict";

    var cols,
        currentSort = {
        index: 0,
        desc: false
    };

    // returns the summary table element
    function getTable() {
        return document.querySelector('.coverage-summary');
    }
    // returns the thead element of the summary table
    function getTableHeader() {
        return getTable().querySelector('thead tr');
    }
    // returns the tbody element of the summary table
    function getTableBody() {
        return getTable().querySelector('tbody');
    }
    // returns the th element for nth column
    function getNthColumn(n) {
        return getTableHeader().querySelectorAll('th')[n];
    }

    // loads all columns
    function loadColumns() {
        var colNodes = getTableHeader().querySelectorAll('th'),
            colNode,
            cols = [],
            col,
            i;

        for (i = 0; i < colNodes.length; i += 1) {
            colNode = colNodes[i];
            col = {
                key: colNode.getAttribute('data-col'),
                sortable: !colNode.getAttribute('data-nosort'),
                type: colNode.getAttribute('data-type') || 'string'
            };
            cols.push(col);
            if (col.sortable) {
                col.defaultDescSort = col.type === 'number';
                colNode.innerHTML = colNode.innerHTML + '<span class="sorter"></span>';
            }
        }
        return cols;
    }
    // attaches a data attribute to every tr element with an object
    // of data values keyed by column name
    function loadRowData(tableRow) {
        var tableCols = tableRow.querySelectorAll('td'),
            colNode,
            col,
            data = {},
            i,
            val;
        for (i = 0; i < tableCols.length; i += 1) {
            colNode = tableCols[i];
            col = cols[i];
            val = colNode.getAttribute('data-value');
            if (col.type === 'number') {
                val = Number(val);
            }
            data[col.key] = val;
        }
        return data;
    }
    // loads all row data
    function loadData() {
        var rows = getTableBody().querySelectorAll('tr'),
            i;

        for (i = 0; i < rows.length; i += 1) {
            rows[i].data = loadRowData(rows[i]);
        }
    }
    // sorts the table using the data for the ith column
    function sortByIndex(index, desc) {
        var key = cols[index].key,
            sorter = function sorter(a, b) {
            a = a.data[key];
            b = b.data[key];
            return a < b ? -1 : a > b ? 1 : 0;
        },
            finalSorter = sorter,
            tableBody = document.querySelector('.coverage-summary tbody'),
            rowNodes = tableBody.querySelectorAll('tr'),
            rows = [],
            i;

        if (desc) {
            finalSorter = function finalSorter(a, b) {
                return -1 * sorter(a, b);
            };
        }

        for (i = 0; i < rowNodes.length; i += 1) {
            rows.push(rowNodes[i]);
            tableBody.removeChild(rowNodes[i]);
        }

        rows.sort(finalSorter);

        for (i = 0; i < rows.length; i += 1) {
            tableBody.appendChild(rows[i]);
        }
    }
    // removes sort indicators for current column being sorted
    function removeSortIndicators() {
        var col = getNthColumn(currentSort.index),
            cls = col.className;

        cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
        col.className = cls;
    }
    // adds sort indicators for current column being sorted
    function addSortIndicators() {
        getNthColumn(currentSort.index).className += currentSort.desc ? ' sorted-desc' : ' sorted';
    }
    // adds event listeners for all sorter widgets
    function enableUI() {
        var i,
            el,
            ithSorter = function ithSorter(i) {
            var col = cols[i];

            return function () {
                var desc = col.defaultDescSort;

                if (currentSort.index === i) {
                    desc = !currentSort.desc;
                }
                sortByIndex(i, desc);
                removeSortIndicators();
                currentSort.index = i;
                currentSort.desc = desc;
                addSortIndicators();
            };
        };
        for (i = 0; i < cols.length; i += 1) {
            if (cols[i].sortable) {
                // add the click event handler on the th so users
                // dont have to click on those tiny arrows
                el = getNthColumn(i).querySelector('.sorter').parentElement;
                if (el.addEventListener) {
                    el.addEventListener('click', ithSorter(i));
                } else {
                    el.attachEvent('onclick', ithSorter(i));
                }
            }
        }
    }
    // adds sorting functionality to the UI
    return function () {
        if (!getTable()) {
            return;
        }
        cols = loadColumns();
        loadData(cols);
        addSortIndicators();
        enableUI();
    };
}();

window.addEventListener('load', addSorting);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvcnRlci5qcyJdLCJuYW1lcyI6WyJhZGRTb3J0aW5nIiwiY29scyIsImN1cnJlbnRTb3J0IiwiaW5kZXgiLCJkZXNjIiwiZ2V0VGFibGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRUYWJsZUhlYWRlciIsImdldFRhYmxlQm9keSIsImdldE50aENvbHVtbiIsIm4iLCJxdWVyeVNlbGVjdG9yQWxsIiwibG9hZENvbHVtbnMiLCJjb2xOb2RlcyIsImNvbE5vZGUiLCJjb2wiLCJpIiwibGVuZ3RoIiwia2V5IiwiZ2V0QXR0cmlidXRlIiwic29ydGFibGUiLCJ0eXBlIiwicHVzaCIsImRlZmF1bHREZXNjU29ydCIsImlubmVySFRNTCIsImxvYWRSb3dEYXRhIiwidGFibGVSb3ciLCJ0YWJsZUNvbHMiLCJkYXRhIiwidmFsIiwiTnVtYmVyIiwibG9hZERhdGEiLCJyb3dzIiwic29ydEJ5SW5kZXgiLCJzb3J0ZXIiLCJhIiwiYiIsImZpbmFsU29ydGVyIiwidGFibGVCb2R5Iiwicm93Tm9kZXMiLCJyZW1vdmVDaGlsZCIsInNvcnQiLCJhcHBlbmRDaGlsZCIsInJlbW92ZVNvcnRJbmRpY2F0b3JzIiwiY2xzIiwiY2xhc3NOYW1lIiwicmVwbGFjZSIsImFkZFNvcnRJbmRpY2F0b3JzIiwiZW5hYmxlVUkiLCJlbCIsIml0aFNvcnRlciIsInBhcmVudEVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYXR0YWNoRXZlbnQiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsYUFBYyxZQUFZO0FBQzFCOztBQUNBLFFBQUlDLElBQUo7QUFBQSxRQUNJQyxjQUFjO0FBQ1ZDLGVBQU8sQ0FERztBQUVWQyxjQUFNO0FBRkksS0FEbEI7O0FBTUE7QUFDQSxhQUFTQyxRQUFULEdBQW9CO0FBQUUsZUFBT0MsU0FBU0MsYUFBVCxDQUF1QixtQkFBdkIsQ0FBUDtBQUFxRDtBQUMzRTtBQUNBLGFBQVNDLGNBQVQsR0FBMEI7QUFBRSxlQUFPSCxXQUFX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LENBQUNaLFVBQUwsRUFBaUI7QUFDYjtBQUNIO0FBQ0RKLGVBQU9ZLGFBQVA7QUFDQW1CLGlCQUFTL0IsSUFBVDtBQUNBK0M7QUFDQUM7QUFDSCxLQVJEO0FBU0gsQ0EzSmdCLEVBQWpCOztBQTZKQU0sT0FBT0YsZ0JBQVAsQ0FBd0IsTUFBeEIsRUFBZ0NyRCxVQUFoQyIsImZpbGUiOiJzb3J0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYWRkU29ydGluZyA9IChmdW5jdGlvbiAoKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIGNvbHMsXG4gICAgICAgIGN1cnJlbnRTb3J0ID0ge1xuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgICAgICBkZXNjOiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgLy8gcmV0dXJucyB0aGUgc3VtbWFyeSB0YWJsZSBlbGVtZW50XG4gICAgZnVuY3Rpb24gZ2V0VGFibGUoKSB7IHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY292ZXJhZ2Utc3VtbWFyeScpOyB9XG4gICAgLy8gcmV0dXJucyB0aGUgdGhlYWQgZWxlbWVudCBvZiB0aGUgc3VtbWFyeSB0YWJsZVxuICAgIGZ1bmN0aW9uIGdldFRhYmxlSGVhZGVyKCkgeyByZXR1cm4gZ2V0VGFibGUoKS5xdWVyeVNlbGVjdG9yKCd0aGVhZCB0cicpOyB9XG4gICAgLy8gcmV0dXJucyB0aGUgdGJvZHkgZWxlbWVudCBvZiB0aGUgc3VtbWFyeSB0YWJsZVxuICAgIGZ1bmN0aW9uIGdldFRhYmxlQm9keSgpIHsgcmV0dXJuIGdldFRhYmxlKCkucXVlcnlTZWxlY3RvcigndGJvZHknKTsgfVxuICAgIC8vIHJldHVybnMgdGhlIHRoIGVsZW1lbnQgZm9yIG50aCBjb2x1bW5cbiAgICBmdW5jdGlvbiBnZXROdGhDb2x1bW4obikgeyByZXR1cm4gZ2V0VGFibGVIZWFkZXIoKS5xdWVyeVNlbGVjdG9yQWxsKCd0aCcpW25dOyB9XG5cbiAgICAvLyBsb2FkcyBhbGwgY29sdW1uc1xuICAgIGZ1bmN0aW9uIGxvYWRDb2x1bW5zKCkge1xuICAgICAgICB2YXIgY29sTm9kZXMgPSBnZXRUYWJsZUhlYWRlcigpLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoJyksXG4gICAgICAgICAgICBjb2xOb2RlLFxuICAgICAgICAgICAgY29scyA9IFtdLFxuICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgaTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29sTm9kZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbE5vZGUgPSBjb2xOb2Rlc1tpXTtcbiAgICAgICAgICAgIGNvbCA9IHtcbiAgICAgICAgICAgICAgICBrZXk6IGNvbE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbCcpLFxuICAgICAgICAgICAgICAgIHNvcnRhYmxlOiAhY29sTm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9zb3J0JyksXG4gICAgICAgICAgICAgICAgdHlwZTogY29sTm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHlwZScpIHx8ICdzdHJpbmcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29scy5wdXNoKGNvbCk7XG4gICAgICAgICAgICBpZiAoY29sLnNvcnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29sLmRlZmF1bHREZXNjU29ydCA9IGNvbC50eXBlID09PSAnbnVtYmVyJztcbiAgICAgICAgICAgICAgICBjb2xOb2RlLmlubmVySFRNTCA9IGNvbE5vZGUuaW5uZXJIVE1MICsgJzxzcGFuIGNsYXNzPVwic29ydGVyXCI+PC9zcGFuPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbHM7XG4gICAgfVxuICAgIC8vIGF0dGFjaGVzIGEgZGF0YSBhdHRyaWJ1dGUgdG8gZXZlcnkgdHIgZWxlbWVudCB3aXRoIGFuIG9iamVjdFxuICAgIC8vIG9mIGRhdGEgdmFsdWVzIGtleWVkIGJ5IGNvbHVtbiBuYW1lXG4gICAgZnVuY3Rpb24gbG9hZFJvd0RhdGEodGFibGVSb3cpIHtcbiAgICAgICAgdmFyIHRhYmxlQ29scyA9IHRhYmxlUm93LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJyksXG4gICAgICAgICAgICBjb2xOb2RlLFxuICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgZGF0YSA9IHt9LFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIHZhbDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhYmxlQ29scy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29sTm9kZSA9IHRhYmxlQ29sc1tpXTtcbiAgICAgICAgICAgIGNvbCA9IGNvbHNbaV07XG4gICAgICAgICAgICB2YWwgPSBjb2xOb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xuICAgICAgICAgICAgaWYgKGNvbC50eXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHZhbCA9IE51bWJlcih2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0YVtjb2wua2V5XSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgLy8gbG9hZHMgYWxsIHJvdyBkYXRhXG4gICAgZnVuY3Rpb24gbG9hZERhdGEoKSB7XG4gICAgICAgIHZhciByb3dzID0gZ2V0VGFibGVCb2R5KCkucXVlcnlTZWxlY3RvckFsbCgndHInKSxcbiAgICAgICAgICAgIGk7XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIHJvd3NbaV0uZGF0YSA9IGxvYWRSb3dEYXRhKHJvd3NbaV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIHNvcnRzIHRoZSB0YWJsZSB1c2luZyB0aGUgZGF0YSBmb3IgdGhlIGl0aCBjb2x1bW5cbiAgICBmdW5jdGlvbiBzb3J0QnlJbmRleChpbmRleCwgZGVzYykge1xuICAgICAgICB2YXIga2V5ID0gY29sc1tpbmRleF0ua2V5LFxuICAgICAgICAgICAgc29ydGVyID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICBhID0gYS5kYXRhW2tleV07XG4gICAgICAgICAgICAgICAgYiA9IGIuZGF0YVtrZXldO1xuICAgICAgICAgICAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaW5hbFNvcnRlciA9IHNvcnRlcixcbiAgICAgICAgICAgIHRhYmxlQm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb3ZlcmFnZS1zdW1tYXJ5IHRib2R5JyksXG4gICAgICAgICAgICByb3dOb2RlcyA9IHRhYmxlQm9keS5xdWVyeVNlbGVjdG9yQWxsKCd0cicpLFxuICAgICAgICAgICAgcm93cyA9IFtdLFxuICAgICAgICAgICAgaTtcblxuICAgICAgICBpZiAoZGVzYykge1xuICAgICAgICAgICAgZmluYWxTb3J0ZXIgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMSAqIHNvcnRlcihhLCBiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Tm9kZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIHJvd3MucHVzaChyb3dOb2Rlc1tpXSk7XG4gICAgICAgICAgICB0YWJsZUJvZHkucmVtb3ZlQ2hpbGQocm93Tm9kZXNbaV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcm93cy5zb3J0KGZpbmFsU29ydGVyKTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgdGFibGVCb2R5LmFwcGVuZENoaWxkKHJvd3NbaV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIHJlbW92ZXMgc29ydCBpbmRpY2F0b3JzIGZvciBjdXJyZW50IGNvbHVtbiBiZWluZyBzb3J0ZWRcbiAgICBmdW5jdGlvbiByZW1vdmVTb3J0SW5kaWNhdG9ycygpIHtcbiAgICAgICAgdmFyIGNvbCA9IGdldE50aENvbHVtbihjdXJyZW50U29ydC5pbmRleCksXG4gICAgICAgICAgICBjbHMgPSBjb2wuY2xhc3NOYW1lO1xuXG4gICAgICAgIGNscyA9IGNscy5yZXBsYWNlKC8gc29ydGVkJC8sICcnKS5yZXBsYWNlKC8gc29ydGVkLWRlc2MkLywgJycpO1xuICAgICAgICBjb2wuY2xhc3NOYW1lID0gY2xzO1xuICAgIH1cbiAgICAvLyBhZGRzIHNvcnQgaW5kaWNhdG9ycyBmb3IgY3VycmVudCBjb2x1bW4gYmVpbmcgc29ydGVkXG4gICAgZnVuY3Rpb24gYWRkU29ydEluZGljYXRvcnMoKSB7XG4gICAgICAgIGdldE50aENvbHVtbihjdXJyZW50U29ydC5pbmRleCkuY2xhc3NOYW1lICs9IGN1cnJlbnRTb3J0LmRlc2MgPyAnIHNvcnRlZC1kZXNjJyA6ICcgc29ydGVkJztcbiAgICB9XG4gICAgLy8gYWRkcyBldmVudCBsaXN0ZW5lcnMgZm9yIGFsbCBzb3J0ZXIgd2lkZ2V0c1xuICAgIGZ1bmN0aW9uIGVuYWJsZVVJKCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGVsLFxuICAgICAgICAgICAgaXRoU29ydGVyID0gZnVuY3Rpb24gaXRoU29ydGVyKGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29sID0gY29sc1tpXTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZXNjID0gY29sLmRlZmF1bHREZXNjU29ydDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFNvcnQuaW5kZXggPT09IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSAhY3VycmVudFNvcnQuZGVzYztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzb3J0QnlJbmRleChpLCBkZXNjKTtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU29ydEluZGljYXRvcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFNvcnQuaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U29ydC5kZXNjID0gZGVzYztcbiAgICAgICAgICAgICAgICAgICAgYWRkU29ydEluZGljYXRvcnMoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgZm9yIChpID0wIDsgaSA8IGNvbHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGlmIChjb2xzW2ldLnNvcnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBjbGljayBldmVudCBoYW5kbGVyIG9uIHRoZSB0aCBzbyB1c2Vyc1xuICAgICAgICAgICAgICAgIC8vIGRvbnQgaGF2ZSB0byBjbGljayBvbiB0aG9zZSB0aW55IGFycm93c1xuICAgICAgICAgICAgICAgIGVsID0gZ2V0TnRoQ29sdW1uKGkpLnF1ZXJ5U2VsZWN0b3IoJy5zb3J0ZXInKS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgIGlmIChlbC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaXRoU29ydGVyKGkpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbC5hdHRhY2hFdmVudCgnb25jbGljaycsIGl0aFNvcnRlcihpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGFkZHMgc29ydGluZyBmdW5jdGlvbmFsaXR5IHRvIHRoZSBVSVxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghZ2V0VGFibGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbHMgPSBsb2FkQ29sdW1ucygpO1xuICAgICAgICBsb2FkRGF0YShjb2xzKTtcbiAgICAgICAgYWRkU29ydEluZGljYXRvcnMoKTtcbiAgICAgICAgZW5hYmxlVUkoKTtcbiAgICB9O1xufSkoKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBhZGRTb3J0aW5nKTtcbiJdfQ==